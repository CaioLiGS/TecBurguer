@page
@model VerifyResetCodeModel

<link rel="stylesheet" href="~/css/Register.css" asp-append-version="true">

<div class="Ball1"></div>
<div class="Ball3"></div>

<div class="OutBox">
    <div class="Box" id="RightBox">

        <div>
            <img src="~/css/Imagens/BurguerLogo.png" alt="TecBurguer Logo">
            <h1>TecBurger</h1>
        </div>

        <form method="post" asp-page-handler="Confirm">
            <input type="hidden" asp-for="Email" value="@Model.Email" />

            <h2>Confirmação de Email</h2>

            <div class="form-floating confirmation-code-inputs">
                <div class="confirmation-code-boxes" style="flex-direction: row;">
                    @for (int i = 0; i < 6; i++)
                    {
                        <input type="text" maxlength="1" pattern="[0-9]*" inputmode="numeric" class="form-control code-box" id="codeBox_@i" name="ConfirmationCodeDigits" required style="width:2.5em;display:inline-block;text-align:center;margin-right:0.3em;" />
                    }
                </div>
            </div>

            <p>Enviamos um código de confimação para o seu email, digite-o aqui para conferirmos se realmente é você!</p>
            <input type="hidden" asp-for="Code" id="ConfirmationCode" value="" />
            <script>

                const form = document.querySelector('form[method="post"]');
                const hiddenInput = document.getElementById('ConfirmationCode');

                document.querySelectorAll('.code-box').forEach((box, idx, arr) => {
                    box.addEventListener('input', function (e) {
                        if (this.value.length === 1 && idx < arr.length - 1) {
                            arr[idx + 1].focus();
                        }
                        if (idx === arr.length - 1 && this.value.length === 1) {
                            fullCode = '';

                            for (let i = 0; i < 6; i++) {
                                console.log()
                                fullCode += document.getElementById(`codeBox_${i}`).value;
                            }

                            hiddenInput.value = fullCode;

                        }
                    });
                    box.addEventListener('keydown', function (e) {
                        if (e.key === 'Backspace' && this.value === '' && idx > 0) {
                            arr[idx - 1].focus();
                        }
                    });
                });
            </script>
            <button type="submit" class="btn btn-primary">Confirmar código</button>
        </form>

    </div>
</div>

<style>

    .confirmation-code-boxes {
        flex-direction: row;
        align-items: center;
        justify-content: space-evenly;
    }

    .confirmation-code-boxes .code-box {
        font-size: 1.5em;
        margin-right: 0.3em;
        text-align: center;
        width: 1em;
        height: 3em;
        display: inline-block;
        border-radius: 10px;
    }

    #RightBox {
        width: 50%;
        border-radius: 15px 15px 15px 15px;
    }
</style>

