@using Microsoft.AspNetCore.Identity
@using TecBurguer.Areas.Identity.Data

@model IEnumerable<TecBurguer.Models.Hamburguer>

@inject UserManager<LoginCliente> UserManager
@inject SignInManager<LoginCliente> SignInManager

@{
    ViewData["Title"] = "Home Page";

    var ofertasAtivas = ViewData["OfertasAtivas"] as IEnumerable<TecBurguer.Models.Ofertas>;
}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ranchers&display=swap" rel="stylesheet">


<div class="BannerContent" id="BannerContent">
    <div class="BannerBall1"></div>
    <div class="BannerBall2"></div>

    <div class="conteudoBannerContent">
        <div class="textos reveal">
            <h1>TEC</h1>
            <h1 style="color: var(--primary); -webkit-text-stroke: 0;">BURGUER</h1>
            <p style="font-size: 1.2rem; opacity: 0.8; margin-top: 10px;">O sabor do futuro, hoje no seu prato.</p>

            <a href="#Cardapio" class="ScrollDown" style="background: var(--primary); color: white; padding: 15px 30px; border-radius: 50px; text-decoration: none; font-weight: bold; margin-top: 20px; display: inline-block; box-shadow: var(--glow); animation: none;">
                PEDIR AGORA
            </a>
        </div>

        <div class="bannerWrapper reveal">
            <img class="BurgerImageBanner active" id="bannerPrincipal" src="/css/Imagens/BurguerLogo.png" alt="Hamburguer">
        </div>
    </div>

    <div class="BannerOverlay">
        <a href="#OfertasDiarias" class="ScrollDown">
            Deslize
            <i class="fas fa-chevron-down" style="margin-top: 5px;"></i>
        </a>
    </div>
</div>

<script>
    // Lógica apenas para o Banner Hero (independente do slider de recomendação)
    var imagens = [
        @foreach (var item in Model)
        {
                @: "@Html.DisplayFor(modelItem => item.Imagem)",
        }
    ];

    var index = 0;
    var bannerWrapper = document.querySelector(".bannerWrapper");

    function trocarImagemBanner() {
        if (!imagens.length || !bannerWrapper) return;
        var atual = document.querySelector(".BurgerImageBanner.active");
        var proxima = document.createElement("img");
        proxima.src = imagens[index];
        proxima.className = "BurgerImageBanner";
        bannerWrapper.appendChild(proxima);
        void proxima.offsetWidth; // Force reflow
        proxima.classList.add("active");

        if (atual) {
            atual.classList.remove("active");
            atual.classList.add("exit");
            setTimeout(() => { if(atual.parentNode === bannerWrapper) bannerWrapper.removeChild(atual); }, 500);
        }
        index = (index + 1) % imagens.length;
    }
    setInterval(trocarImagemBanner, 5000);
    trocarImagemBanner();
</script>

<div class="Content1" id="OfertasDiarias">
    <h2 class="section-title reveal">OFERTAS EM CHAMAS 🔥</h2>

    <div class="cards-container reveal">
        @if (ofertasAtivas != null && ofertasAtivas.Any())
        {
            @foreach (var oferta in ofertasAtivas)
            {
                if (oferta.idHamburguerNavigation == null) { continue; }
                var item = oferta.idHamburguerNavigation;

                <div class="BlocoHamburguer">
                    <div class="FaixaHamburguer">@(oferta.porcentagem >= 30 ? "MEGA!!" : "OFERTA")</div>

                    <img src="@Html.DisplayFor(modelItem => item.Imagem)" class="ImagemHamburguer" onerror="this.src='/css/Imagens/BurguerLogo.png'">

                    <h3 class="TituloHamburguer">@item.Nome</h3>
                    <p class="DescricaoHamburguer">@item.Descricao</p>

                    <div class="BottomInfoBurguer">
                        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                            <div>
                                <span style="text-decoration: line-through; color: #666; font-size: 0.9rem;">R$ @item.Preco</span>
                                <h4 class="PrecoBurguer">R$ @oferta.precoFinal</h4>
                            </div>
                            <h3 class="PorcentagemOferta">-@oferta.porcentagem%</h3>
                        </div>

                        <div class="BotoesDoHamburguer">
                            @if (SignInManager.IsSignedIn(User))
                            {
                                <a class="CartBurguer" onclick="adicionarAoCarrinho('@item.Nome', @item.Preco, '@item.IdHamburguer', '@UserManager.GetUserName(User)')">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            }
                            else
                            {
                                <a class="CartBurguer" onclick="mostrarBotaoLogin()">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            }
                            <a class="SaibaMaisHamburguer" asp-controller="Hamburgueres" asp-action="Details" asp-route-id="@item.IdHamburguer">DETALHES</a>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div style="width: 100%; text-align: center; padding: 50px; color: #777;">
                <h3>Nenhuma oferta pegando fogo hoje.</h3>
            </div>
        }
    </div>
</div>

<div class="Content2 reveal" id="RecomendacoesDoChefe">
    <h1 class="section-title" style="color: white; text-shadow: 0 0 20px var(--primary);">RECOMENDAÇÕES DO CHEFE</h1>

    <div class="ConteudoRecomendacoesDoChefe">
        <div class="carrossel-wrapper">
            @foreach (var item in Model)
            {
                @if (item.Categoria == "Recomendação do chefe")
                {
                    <div class="item-recomendacao">
                        <img src="@item.Imagem" onerror="this.src='/css/Imagens/BurguerLogo.png'">

                        <div class="info">
                            <div>
                                <h2 class="TituloRDC">@item.Nome</h2>
                                <p style="color: var(--text-light); opacity: 0.9; margin-bottom: 15px;">@item.Descricao</p>

                                <h5 style="font-weight: bold; font-size: 1.2rem; color: var(--accent); text-align: left; margin-top: 10px;">Ingredientes:</h5>
                                <ul class="lista-ingredientes">
                                    @foreach (var ingrediente in item.HamburguerIgredientes)
                                    {
                                        @if (ingrediente.IdIngredienteNavigation != null)
                                        {
                                            <li>@ingrediente.IdIngredienteNavigation.Nome</li>
                                        }
                                    }
                                </ul>
                            </div>

                            <div class="BotoesRDC">
                                @if (SignInManager.IsSignedIn(User))
                                {
                                    <a class="CartBurguer" style="width: 50%; border-radius: 30px; gap: 10px;"
                                       onclick="adicionarAoCarrinho('@item.Nome', @item.Preco, '@item.IdHamburguer', '@UserManager.GetUserName(User)')">
                                        <i class="fas fa-shopping-cart"></i> Adicionar
                                    </a>
                                }
                                else
                                {
                                    <a class="CartBurguer" style="width: 50%; border-radius: 30px; gap: 10px;"
                                       onclick="mostrarBotaoLogin()">
                                        <i class="fas fa-shopping-cart"></i> Adicionar
                                    </a>
                                }
                                <a class="SaibaMaisHamburguer" style="width: 50%; border-radius: 30px;" asp-controller="Hamburgueres" asp-action="Details" asp-route-id="@item.IdHamburguer">
                                    Saiba Mais
                                </a>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <button class="prev-slide" onclick="prevSlide()"><i class="fas fa-chevron-left"></i></button>
        <button class="next-slide" onclick="nextSlide()"><i class="fas fa-chevron-right"></i></button>
    </div>
</div>

<div class="Content1" id="Cardapio" style="height: auto; padding-bottom: 50px;">
    <h2 class="section-title reveal">CARDÁPIO COMPLETO</h2>

    <div class="cards-container reveal" style="flex-wrap: wrap; justify-content: center; overflow: visible;">
        @foreach (var item in Model)
        {
            var promocao = false;
            @if (ofertasAtivas != null && ofertasAtivas.Any())
            {
                foreach (var oferta in ofertasAtivas)
                {
                    if (oferta.idHamburguerNavigation != null && oferta.idHamburguerNavigation.IdHamburguer == item.IdHamburguer)
                    {
                        promocao = true;
                        break;
                    }
                }
            }

            @if (!promocao)
            {
                <div class="BlocoHamburguer" style="margin-bottom: 30px;">
                    <img src="@Html.DisplayFor(modelItem => item.Imagem)" class="ImagemHamburguer" onerror="this.src='/css/Imagens/BurguerLogo.png'">

                    <h3 class="TituloHamburguer">@item.Nome</h3>
                    <p class="DescricaoHamburguer">@item.Descricao</p>

                    <div class="BottomInfoBurguer">
                        <h4 class="PrecoBurguer">R$ @item.Preco</h4>
                        <div class="BotoesDoHamburguer">
                            @if (SignInManager.IsSignedIn(User))
                            {
                                <a class="CartBurguer" onclick="adicionarAoCarrinho('@item.Nome', @item.Preco, '@item.IdHamburguer', '@UserManager.GetUserName(User)')">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            }
                            else
                            {
                                <a class="CartBurguer" onclick="mostrarBotaoLogin()">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            }
                            <a class="SaibaMaisHamburguer" asp-controller="Hamburgueres" asp-action="Details" asp-route-id="@item.IdHamburguer">VER MAIS</a>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
    <div style="text-align: center; padding-bottom: 30px;">
        <a style="color: var(--primary); text-decoration: underline; cursor: pointer;">Acesse nosso cardapio completo</a>
    </div>
</div>

<div id="FacaLogin">

    <img src="~/css/Imagens/BurguerLogo.png" alt="Logo">
    <div style="flex-grow: 1;">
        @if (SignInManager.IsSignedIn(User))
        {
            <h3>Adicionado!</h3>
            <p>Item no carrinho.</p>
            <div style="margin-top: 10px;">
                <a class="BotaoLogin" asp-area="" asp-controller="Home" asp-action="Cart">Ir para Carrinho</a>
            </div>
        }
        else
        {
            <h3>Psiu! 🍔</h3>
            <p>Faça login para continuar.</p>
            <div style="margin-top: 10px;">
                <a class="BotaoCriarConta" asp-area="Identity" asp-page="/Account/Register">Criar conta</a>
                <a class="BotaoLogin" asp-area="Identity" asp-page="/Account/Login">Login</a>
            </div>
        }
    </div>
    <button onclick="fecharPopup()" style="background: transparent; border: none; font-size: 1.2rem; cursor: pointer; color: #333;">&times;</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="~/js/site.js"></script>
                <script>
                    window.addEventListener('scroll', reveal);
        function reveal() {
            var reveals = document.querySelectorAll('.reveal');
            for (var i = 0; i < reveals.length; i++) {
            var windowheight = window.innerHeight;
            var revealtop = reveals[i].getBoundingClientRect().top;
            var revealpoint = 150;
            if (revealtop < windowheight - revealpoint) {
                reveals[i].classList.add('active');
            }
        }
    }
    reveal();
                </script>